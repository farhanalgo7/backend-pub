<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>docker_debrief.create_json &mdash; Documentation for Fabric 1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Documentation for Fabric
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">backend_pub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Documentation for Fabric</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">docker_debrief.create_json</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for docker_debrief.create_json</h1><div class="highlight"><pre>
<div class="viewcode-block" id="dict_None_output"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.dict_None_output">[docs]</a><span></span><span class="k">def</span> <span class="nf">dict_None_output</span><span class="p">():</span>
    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="dict_output"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.dict_output">[docs]</a><span class="k">def</span> <span class="nf">dict_output</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">dict_None_output</span><span class="p">)</span></div>



<div class="viewcode-block" id="updated_dict"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.updated_dict">[docs]</a><span class="k">def</span> <span class="nf">updated_dict</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span></div>



<div class="viewcode-block" id="working_check"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.working_check">[docs]</a><span class="k">def</span> <span class="nf">working_check</span><span class="p">():</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">bse</span> <span class="o">=</span> <span class="n">mcal</span><span class="o">.</span><span class="n">get_calendar</span><span class="p">(</span><span class="s1">&#39;BSE&#39;</span><span class="p">)</span>
    <span class="n">early</span> <span class="o">=</span> <span class="n">bse</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="p">))</span>
    <span class="n">early</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">list_working_days</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">early</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]:</span>
        <span class="n">list_working_days</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">date</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">list_working_days</span></div>



<div class="viewcode-block" id="read_data_from_s3"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.read_data_from_s3">[docs]</a><span class="k">def</span> <span class="nf">read_data_from_s3</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s1">&#39;Json/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="n">file_content</span> <span class="o">=</span> <span class="n">content_object</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">json_content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;read_data_from_s3&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json_content</span></div>



<div class="viewcode-block" id="fetch_data_summary"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.fetch_data_summary">[docs]</a><span class="k">def</span> <span class="nf">fetch_data_summary</span><span class="p">(</span><span class="n">ticker_name</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">summary_json</span><span class="p">,</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="n">all_tweets</span><span class="p">,</span> <span class="n">all_news</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create Summary dict for a given ticker from since to until</span>

<span class="sd">    Args:</span>
<span class="sd">        ticker_name (string): Ticker name</span>
<span class="sd">        today_date(datetime): Current date in IST</span>
<span class="sd">        summary_data_days(datetime): date to which have to generate summary</span>
<span class="sd">        summary_json(dict): Summary with updated date</span>
<span class="sd">        ticker_id(string): ticker Symbol</span>
<span class="sd">        all_tweets(dict): all tweets groupby ticker_id</span>
<span class="sd">        all_news(dict): all news groupby ticker_id</span>



<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary of today news with colors as per percentile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">news_count</span><span class="p">,</span> <span class="n">news_sent</span><span class="p">,</span> <span class="n">today_news</span><span class="p">,</span> <span class="n">today_news_sent</span><span class="p">)</span> <span class="o">=</span> <span class="n">sum_get_total_news</span><span class="p">(</span><span class="n">ticker_name</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">all_news</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">TODAY NEWS:</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">today_news</span><span class="p">)</span>
    <span class="p">(</span><span class="n">tweet_count</span><span class="p">,</span> <span class="n">tweets_sent</span><span class="p">,</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="n">today_tweet_sent</span><span class="p">)</span> <span class="o">=</span> <span class="n">sum_get_total_tweets</span><span class="p">(</span><span class="n">ticker_name</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">all_tweets</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">TODAY TWEETS: &#39;</span><span class="p">,</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">news_quartile</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">NEWSCOUNT = &#39;</span><span class="p">,</span> <span class="n">news_count</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">NEWS COUNT LENGTH = &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">news_count</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">news_count</span><span class="p">:</span>
        <span class="n">news_quartile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;newscount&#39;</span><span class="p">])</span>
    <span class="n">tweet_quartile</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">TWEET COUNT = &#39;</span><span class="p">,</span> <span class="n">tweet_count</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">TWEET COUNT LENGTH = &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tweet_count</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tweet_count</span><span class="p">:</span>
        <span class="n">tweet_quartile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweetcount&#39;</span><span class="p">])</span>
    <span class="n">today_date</span> <span class="o">=</span> <span class="n">today_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">summary_data_days</span> <span class="o">=</span> <span class="n">summary_data_days</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">TODAY DATE: &#39;</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">TODAY DATE TYPE: &#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">today_date</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nw</span> <span class="o">&gt;=</span> <span class="n">time1</span> <span class="ow">and</span> <span class="n">nw</span> <span class="o">&lt;=</span> <span class="n">time2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">QUERY:</span><span class="se">\n\n</span><span class="s2">select Open, Close, Volume, DATE_FORMAT(date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;)  from </span><span class="si">{}</span><span class="s2"> where ticker_id=&#39;</span><span class="si">{}</span><span class="s2">&#39; and DATE_FORMAT(date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;) between &#39;</span><span class="si">{}</span><span class="s2">&#39; and &#39;</span><span class="si">{}</span><span class="s2">&#39;  </span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">today_date</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select Open, Close, Volume, date(date)  from </span><span class="si">{}</span><span class="s2"> where ticker_id=&#39;</span><span class="si">{}</span><span class="s2">&#39; and date(date) between &#39;</span><span class="si">{}</span><span class="s2">&#39; and &#39;</span><span class="si">{}</span><span class="s2">&#39;  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">today_date</span><span class="p">))</span>
        <span class="n">fetched_result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))}</span>
        <span class="n">filename1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/fetched_result.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_id</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing to s3 for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_id</span><span class="p">))</span>
        <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename1</span><span class="p">,</span> <span class="n">fetched_result</span><span class="p">)</span>
        <span class="n">fetched_result</span> <span class="o">=</span> <span class="n">fetched_result</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
        <span class="n">volumes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">returns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_volumes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_retuns</span> <span class="o">=</span> <span class="n">fetched_result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fetched_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">today_date</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">time_yestarday</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">most_recent</span> <span class="o">=</span> <span class="n">today_date</span> <span class="o">-</span> <span class="n">time_yestarday</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;today_date.weekday()&#39;</span><span class="p">,</span> <span class="n">today_date</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ttime_yestarday&#39;</span><span class="p">,</span> <span class="n">time_yestarday</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;most_recent&#39;</span><span class="p">,</span> <span class="n">most_recent</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">most_recent</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">time_yestarday</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
            <span class="n">most_recent</span> <span class="o">=</span> <span class="n">today_date</span> <span class="o">-</span> <span class="n">time_yestarday</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;today_date: &#39;</span><span class="p">,</span> <span class="n">today_date</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="s2">&quot;select close  from </span><span class="si">{}</span><span class="s2">  where DATE_FORMAT(date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;) =&#39;</span><span class="si">{}</span><span class="s2">&#39; and ticker_id=&#39;</span><span class="si">{}</span><span class="s2">&#39; and DATE_FORMAT(date, &#39;%H&#39;) &gt;= &#39;</span><span class="si">{}</span><span class="s2">&#39; order by date desc limit 1  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">most_recent</span><span class="p">,</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select close  from </span><span class="si">{}</span><span class="s2">  where DATE_FORMAT(date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;) =&#39;</span><span class="si">{}</span><span class="s2">&#39; and ticker_id=&#39;</span><span class="si">{}</span><span class="s2">&#39; and DATE_FORMAT(date, &#39;%H&#39;) &gt;= &#39;</span><span class="si">{}</span><span class="s2">&#39; order by date desc limit 1  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">most_recent</span><span class="p">,</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">filename2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/yestarday_close.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_id</span><span class="p">)</span>
        <span class="n">yestarday_close</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">yestarday_close</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]}</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename2</span><span class="p">,</span> <span class="n">yestarday_close</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yestarday_close</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename2</span><span class="p">)</span>
        <span class="n">yestarday_close</span> <span class="o">=</span> <span class="n">yestarday_close</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
        <span class="n">var</span> <span class="o">=</span> <span class="s2">&quot;select Close  from </span><span class="si">{}</span><span class="s2"> where ticker_id=&#39;</span><span class="si">{}</span><span class="s2">&#39; and DATE_FORMAT(date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;) = &#39;</span><span class="si">{}</span><span class="s2">&#39; order by date desc limit 1 &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="n">today_date</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select Close  from </span><span class="si">{}</span><span class="s2"> where ticker_id=&#39;</span><span class="si">{}</span><span class="s2">&#39; and date(date) = &#39;</span><span class="si">{}</span><span class="s2">&#39; order by date desc limit 1 &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="n">today_date</span><span class="p">))</span>
        <span class="n">res2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;res2&#39;</span><span class="p">,</span> <span class="n">res2</span><span class="p">)</span>
        <span class="n">filename3</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/today_current.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_id</span><span class="p">)</span>
        <span class="n">today_current</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">today_current</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="n">res2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]}</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename3</span><span class="p">,</span> <span class="n">today_current</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">today_current</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename3</span><span class="p">)</span>
        <span class="n">today_current</span> <span class="o">=</span> <span class="n">today_current</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">yestarday_close</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">today_return</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">today_return</span> <span class="o">=</span> <span class="p">(</span><span class="n">today_current</span> <span class="o">-</span> <span class="n">yestarday_close</span><span class="p">)</span> <span class="o">/</span> <span class="n">yestarday_close</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">today_volume</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fetched_result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">FETCHED RESULT: &#39;</span><span class="p">,</span> <span class="n">fetched_result</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fetched_result</span><span class="p">:</span>
            <span class="n">volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">total_volumes</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fetched_result</span><span class="p">)):</span>
            <span class="n">returns</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fetched_result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fetched_result</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">fetched_result</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">tweets_sent</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">tweets_sent</span><span class="p">)</span>
        <span class="n">total_tweets_sent</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tweets_sent</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]:</span>
                <span class="n">total_tweets_sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_score&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total_tweets_sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">news_sent</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">news_sent</span><span class="p">)</span>
        <span class="n">total_news_sent</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">news_sent</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]:</span>
                <span class="n">total_news_sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_score&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total_news_sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">tweets_sent_quantile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">total_tweets_sent</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">news_sent_quantile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">total_news_sent</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">v_quantile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">volumes</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">r_quantile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">news_quartile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">news_quartile</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">tweet_quartile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tweet_quartile</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">yestarday_close</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result_summary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">:</span> <span class="n">today_news</span><span class="p">,</span> <span class="s1">&#39;Today_News_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">news_quartile</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">:</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">tweet_quartile</span><span class="p">,</span> <span class="s1">&#39;Today_Returns_percentile&#39;</span><span class="p">:</span> <span class="n">r_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Volume&#39;</span><span class="p">:</span> <span class="n">today_volume</span><span class="p">,</span> <span class="s1">&#39;Today_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">v_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Returns&#39;</span><span class="p">:</span> <span class="n">today_return</span><span class="p">,</span> <span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">today_news_sent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_News_Sentiment_percentile&#39;</span><span class="p">:</span> <span class="n">news_sent_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">today_tweet_sent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_Tweet_Sentiment_percentile&#39;</span><span class="p">:</span> <span class="n">tweets_sent_quantile</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result_summary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">:</span> <span class="n">today_news</span><span class="p">,</span> <span class="s1">&#39;Today_News_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">news_quartile</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">:</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">tweet_quartile</span><span class="p">,</span> <span class="s1">&#39;Today_Returns_percentile&#39;</span><span class="p">:</span> <span class="n">r_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Volume&#39;</span><span class="p">:</span> <span class="n">today_volume</span><span class="p">,</span> <span class="s1">&#39;Today_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">v_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Returns&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today_return</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">today_news_sent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_News_Sentiment_percentile&#39;</span><span class="p">:</span> <span class="n">news_sent_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">today_tweet_sent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_Tweet_Sentiment_percentile&#39;</span><span class="p">:</span> <span class="n">tweets_sent_quantile</span><span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">NEWS VOL PERCENTILE: &#39;</span><span class="p">,</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Volume_percentile&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">TWEETS VOL PERCENTILE: &#39;</span><span class="p">,</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Volume_percentile&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">result_summary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;_percentile&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;Sentiment&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;News&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">result_summary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#ccc&#39;</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="s1">&#39;Tweet&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">result_summary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#ccc&#39;</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">result_summary</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_percentile&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#FFC7D4&#39;</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">result_summary</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_percentile&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#FFE7A8&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#84FED2&#39;</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                    <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#84FED2&#39;</span>
        <span class="k">if</span> <span class="n">yestarday_close</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">summary_json</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Stock_Ticker&#39;</span><span class="p">:</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">:</span> <span class="n">today_news</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">:</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="s1">&#39;Total_Returns&#39;</span><span class="p">:</span> <span class="n">total_retuns</span><span class="p">,</span> <span class="s1">&#39;Today_Volume&#39;</span><span class="p">:</span> <span class="n">today_volume</span><span class="p">,</span> <span class="s1">&#39;Today_Returns&#39;</span><span class="p">:</span> <span class="n">today_return</span><span class="p">,</span> <span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="s1">&#39;yestarday_close&#39;</span><span class="p">:</span> <span class="n">yestarday_close</span><span class="p">}</span>
            <span class="n">summary_json</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">summary_json</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">summary_json</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Stock_Ticker&#39;</span><span class="p">:</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">:</span> <span class="n">today_news</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">:</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="s1">&#39;Total_Returns&#39;</span><span class="p">:</span> <span class="n">total_retuns</span><span class="p">,</span> <span class="s1">&#39;Today_Volume&#39;</span><span class="p">:</span> <span class="n">today_volume</span><span class="p">,</span> <span class="s1">&#39;Today_Returns&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today_return</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="s1">&#39;yestarday_close&#39;</span><span class="p">:</span> <span class="n">yestarday_close</span><span class="p">}</span>
            <span class="n">summary_json</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;fetch_data_summary&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">summary_json</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading Data from s3 for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_id</span><span class="p">))</span>
        <span class="n">filename1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/fetched_result.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_id</span><span class="p">)</span>
        <span class="n">fetched_result</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename1</span><span class="p">)</span>
        <span class="n">fetched_result</span> <span class="o">=</span> <span class="n">fetched_result</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
        <span class="n">volumes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">returns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_volumes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_retuns</span> <span class="o">=</span> <span class="n">fetched_result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fetched_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">today_date</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">time_yestarday</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">most_recent</span> <span class="o">=</span> <span class="n">today_date</span> <span class="o">-</span> <span class="n">time_yestarday</span>
        <span class="n">filename2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/yestarday_close.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_id</span><span class="p">)</span>
        <span class="n">yestarday_close</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename2</span><span class="p">)</span>
        <span class="n">yestarday_close</span> <span class="o">=</span> <span class="n">yestarday_close</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
        <span class="n">filename3</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/today_current.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_id</span><span class="p">)</span>
        <span class="n">today_current</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename3</span><span class="p">)</span>
        <span class="n">today_current</span> <span class="o">=</span> <span class="n">today_current</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">yestarday_close</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">today_return</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">today_return</span> <span class="o">=</span> <span class="p">(</span><span class="n">today_current</span> <span class="o">-</span> <span class="n">yestarday_close</span><span class="p">)</span> <span class="o">/</span> <span class="n">yestarday_close</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">today_volume</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fetched_result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fetched_result</span><span class="p">:</span>
            <span class="n">volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">total_volumes</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fetched_result</span><span class="p">)):</span>
            <span class="n">returns</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fetched_result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fetched_result</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">fetched_result</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">tweets_sent</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">tweets_sent</span><span class="p">)</span>
        <span class="n">total_tweets_sent</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tweets_sent</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]:</span>
                <span class="n">total_tweets_sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_score&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total_tweets_sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">news_sent</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">news_sent</span><span class="p">)</span>
        <span class="n">total_news_sent</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">news_sent</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]:</span>
                <span class="n">total_news_sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_score&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total_news_sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">tweets_sent_quantile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">total_tweets_sent</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">news_sent_quantile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">total_news_sent</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">v_quantile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">volumes</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">r_quantile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">news_quartile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">news_quartile</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="n">tweet_quartile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tweet_quartile</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">yestarday_close</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result_summary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">:</span> <span class="n">today_news</span><span class="p">,</span> <span class="s1">&#39;Today_News_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">news_quartile</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">:</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">tweet_quartile</span><span class="p">,</span> <span class="s1">&#39;Today_Returns_percentile&#39;</span><span class="p">:</span> <span class="n">r_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Volume&#39;</span><span class="p">:</span> <span class="n">today_volume</span><span class="p">,</span> <span class="s1">&#39;Today_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">v_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Returns&#39;</span><span class="p">:</span> <span class="n">today_return</span><span class="p">,</span> <span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">today_news_sent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_News_Sentiment_percentile&#39;</span><span class="p">:</span> <span class="n">news_sent_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">today_tweet_sent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_Tweet_Sentiment_percentile&#39;</span><span class="p">:</span> <span class="n">tweets_sent_quantile</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result_summary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">:</span> <span class="n">today_news</span><span class="p">,</span> <span class="s1">&#39;Today_News_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">news_quartile</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">:</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">tweet_quartile</span><span class="p">,</span> <span class="s1">&#39;Today_Returns_percentile&#39;</span><span class="p">:</span> <span class="n">r_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Volume&#39;</span><span class="p">:</span> <span class="n">today_volume</span><span class="p">,</span> <span class="s1">&#39;Today_Volume_percentile&#39;</span><span class="p">:</span> <span class="n">v_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Returns&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today_return</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">today_news_sent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_News_Sentiment_percentile&#39;</span><span class="p">:</span> <span class="n">news_sent_quantile</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">today_tweet_sent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_Tweet_Sentiment_percentile&#39;</span><span class="p">:</span> <span class="n">tweets_sent_quantile</span><span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">NEWS VOL PERCENTILE: &#39;</span><span class="p">,</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Volume_percentile&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">TWEETS VOL PERCENTILE: &#39;</span><span class="p">,</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Volume_percentile&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">result_summary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;_percentile&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;Sentiment&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;News&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">result_summary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#ccc&#39;</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="s1">&#39;Tweet&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">result_summary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#ccc&#39;</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">result_summary</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_percentile&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#FFC7D4&#39;</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">result_summary</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_percentile&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#FFE7A8&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#84FED2&#39;</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                    <span class="n">colors</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#84FED2&#39;</span>
        <span class="k">if</span> <span class="n">yestarday_close</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">summary_json</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Stock_Ticker&#39;</span><span class="p">:</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">:</span> <span class="n">today_news</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">:</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="s1">&#39;Total_Returns&#39;</span><span class="p">:</span> <span class="n">total_retuns</span><span class="p">,</span> <span class="s1">&#39;Today_Volume&#39;</span><span class="p">:</span> <span class="n">today_volume</span><span class="p">,</span> <span class="s1">&#39;Today_Returns&#39;</span><span class="p">:</span> <span class="n">today_return</span><span class="p">,</span> <span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="s1">&#39;yestarday_close&#39;</span><span class="p">:</span> <span class="n">yestarday_close</span><span class="p">}</span>
            <span class="n">summary_json</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">summary_json</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">summary_json</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Stock_Ticker&#39;</span><span class="p">:</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="s1">&#39;Today_News_Volume&#39;</span><span class="p">:</span> <span class="n">today_news</span><span class="p">,</span> <span class="s1">&#39;Today_Tweet_Volume&#39;</span><span class="p">:</span> <span class="n">today_tweets</span><span class="p">,</span> <span class="s1">&#39;Total_Returns&#39;</span><span class="p">:</span> <span class="n">total_retuns</span><span class="p">,</span> <span class="s1">&#39;Today_Volume&#39;</span><span class="p">:</span> <span class="n">today_volume</span><span class="p">,</span> <span class="s1">&#39;Today_Returns&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today_return</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_News_Sentiment&#39;</span><span class="p">],</span> <span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="n">result_summary</span><span class="p">[</span><span class="s1">&#39;Today_Tweet_Sentiment&#39;</span><span class="p">],</span> <span class="s1">&#39;yestarday_close&#39;</span><span class="p">:</span> <span class="n">yestarday_close</span><span class="p">}</span>
            <span class="n">summary_json</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">summary_json</span></div>



<div class="viewcode-block" id="create_overview"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.create_overview">[docs]</a><span class="k">def</span> <span class="nf">create_overview</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">list_months</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">all_news</span><span class="p">,</span> <span class="n">all_tweets</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nw</span> <span class="o">&gt;=</span> <span class="n">time1</span> <span class="ow">and</span> <span class="n">nw</span> <span class="o">&lt;=</span> <span class="n">time2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select Volume, DATE_FORMAT(date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;)  from </span><span class="si">{}</span><span class="s2"> where ticker_id=&#39;</span><span class="si">{}</span><span class="s2">&#39; and DATE_FORMAT(date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;) between &#39;</span><span class="si">{}</span><span class="s2">&#39; and &#39;</span><span class="si">{}</span><span class="s2">&#39; and DATE_FORMAT(date, &#39;%H&#39;) &gt;= &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">],</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">))</span>
            <span class="n">yesterday</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))}</span>
            <span class="n">filename4</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/yesterday1.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename4</span><span class="p">,</span> <span class="n">yesterday</span><span class="p">)</span>
            <span class="n">yesterday</span> <span class="o">=</span> <span class="n">yesterday</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">news_count</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">tweet_count</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">news_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_news</span><span class="p">[</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">]]:</span>
                <span class="n">news_count</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;Top_Events&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Null&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]:</span>
                            <span class="n">news_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Event_Type&#39;</span><span class="p">:</span> <span class="s1">&#39;News&#39;</span><span class="p">,</span> <span class="s1">&#39;Event_Name&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="s1">&#39;Events_Detected&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]),</span> <span class="s1">&#39;Event_URL&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">],</span> <span class="s1">&#39;Event_ID&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_ID&#39;</span><span class="p">]})</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_tweets</span><span class="p">[</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">]]:</span>
                <span class="n">tweet_count</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;Top_Events&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Null&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]:</span>
                            <span class="n">news_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Event_Type&#39;</span><span class="p">:</span> <span class="s1">&#39;Tweets&#39;</span><span class="p">,</span> <span class="s1">&#39;Event_Name&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="s1">&#39;Events_Detected&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]),</span> <span class="s1">&#39;Event_URL&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_link&#39;</span><span class="p">],</span> <span class="s1">&#39;Event_ID&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweets_ID&#39;</span><span class="p">]})</span>
            <span class="n">news</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vol_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">date_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tweets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="ow">in</span> <span class="n">yesterday</span><span class="p">:</span>
                <span class="n">news</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">news_count</span><span class="p">[</span><span class="n">date</span><span class="p">])</span>
                <span class="n">tweets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet_count</span><span class="p">[</span><span class="n">date</span><span class="p">])</span>
                <span class="n">vol_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vol</span><span class="p">))</span>
                <span class="n">date_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> %b %Y&#39;</span><span class="p">))</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Volume&#39;</span><span class="p">:</span> <span class="n">vol_data</span><span class="p">,</span> <span class="s1">&#39;News&#39;</span><span class="p">:</span> <span class="n">news</span><span class="p">,</span> <span class="s1">&#39;Tweets&#39;</span><span class="p">:</span> <span class="n">tweets</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date_data</span><span class="p">}</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;create overview&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Graph&#39;</span><span class="p">:</span> <span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;Events&#39;</span><span class="p">:</span> <span class="n">news_data</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename4</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/yesterday1.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">yesterday</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename4</span><span class="p">)</span>
            <span class="n">yesterday</span> <span class="o">=</span> <span class="n">yesterday</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">news_count</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">tweet_count</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">news_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_news</span><span class="p">[</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">]]:</span>
                <span class="n">news_count</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;All_Events&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Null&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]:</span>
                            <span class="n">news_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Event_Type&#39;</span><span class="p">:</span> <span class="s1">&#39;News&#39;</span><span class="p">,</span> <span class="s1">&#39;Event_Name&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="s1">&#39;Events_Detected&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]),</span> <span class="s1">&#39;Event_URL&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">],</span> <span class="s1">&#39;Event_ID&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_ID&#39;</span><span class="p">]})</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_tweets</span><span class="p">[</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">]]:</span>
                <span class="n">tweet_count</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;All_Events&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Null&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]:</span>
                            <span class="n">news_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Event_Type&#39;</span><span class="p">:</span> <span class="s1">&#39;Tweets&#39;</span><span class="p">,</span> <span class="s1">&#39;Event_Name&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="s1">&#39;Events_Detected&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]),</span> <span class="s1">&#39;Event_URL&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_link&#39;</span><span class="p">],</span> <span class="s1">&#39;Event_ID&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweets_ID&#39;</span><span class="p">]})</span>
            <span class="n">news</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vol_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">date_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tweets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="ow">in</span> <span class="n">yesterday</span><span class="p">:</span>
                <span class="n">news</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">news_count</span><span class="p">[</span><span class="n">date</span><span class="p">])</span>
                <span class="n">tweets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet_count</span><span class="p">[</span><span class="n">date</span><span class="p">])</span>
                <span class="n">vol_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vol</span><span class="p">))</span>
                <span class="n">date_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> %b %Y&#39;</span><span class="p">))</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Volume&#39;</span><span class="p">:</span> <span class="n">vol_data</span><span class="p">,</span> <span class="s1">&#39;News&#39;</span><span class="p">:</span> <span class="n">news</span><span class="p">,</span> <span class="s1">&#39;Tweets&#39;</span><span class="p">:</span> <span class="n">tweets</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date_data</span><span class="p">}</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Graph&#39;</span><span class="p">:</span> <span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;Events&#39;</span><span class="p">:</span> <span class="n">news_data</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception in overview &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_tweets"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.create_tweets">[docs]</a><span class="k">def</span> <span class="nf">create_tweets</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">all_tweets</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data_collect</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">events_json</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">s3_topic_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;Json/Tweets/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">):</span>
                <span class="n">events_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">word_cloud_freq</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="ow">in</span> <span class="n">events_json</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">word_cloud_freq</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">word_cloud_freq</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;DATA NOT AVAILABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="p">[]}]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;Topic_Tweets_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">word_cloud_freq</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">})</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_tweets</span><span class="p">[</span><span class="n">ticker_data</span><span class="p">]):</span>
            <span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;updated_tweet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_text&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_ner_flag&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;sentiment_analysis&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="p">(</span><span class="n">pos_sent</span><span class="p">,</span> <span class="n">neg_sent</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sentiment_class</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">sentiment_score</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">sentence</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                                    <span class="n">pos_sent</span> <span class="o">+=</span> <span class="mi">1</span>
                                    <span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;</span><span class="si">{}</span><span class="s1">&lt;/</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">],</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">])</span>
                                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;updated_tweet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;updated_tweet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">str1</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                                    <span class="n">neg_sent</span> <span class="o">+=</span> <span class="mi">1</span>
                                    <span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;</span><span class="si">{}</span><span class="s1">&lt;/</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">],</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">])</span>
                                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;updated_tweet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;updated_tweet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">str1</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;</span><span class="si">{}</span><span class="s1">&lt;/</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="s1">&#39;normal&#39;</span><span class="p">)</span>
                                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;updated_tweet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;updated_tweet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">str1</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception++++++&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pos_sent</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">neg_sent</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sentiment_score</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sentiment_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_sent</span> <span class="o">-</span> <span class="n">neg_sent</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pos_sent</span> <span class="o">+</span> <span class="n">neg_sent</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sentiment_score</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sentiment_class</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span>
                <span class="k">elif</span> <span class="n">sentiment_score</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sentiment_class</span> <span class="o">=</span> <span class="s1">&#39;negative&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sentiment_class</span> <span class="o">=</span> <span class="s1">&#39;neutral&#39;</span>
                <span class="n">Events_Detected</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Labels</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;Top_Events&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Null&#39;</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]:</span>
                                <span class="n">Events_Detected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>
                                <span class="n">Labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Top_Event Key not found in tweets&#39;</span><span class="p">)</span>
                    <span class="n">dict1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Tweet_Sentiment&#39;</span><span class="p">:</span> <span class="n">sentiment_class</span><span class="p">,</span> <span class="s1">&#39;Tweet_Time_Stamp&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Tweet_Sentiment_Score&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">sentiment_score</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Tweet_Tags&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Tweet_Source&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_by&#39;</span><span class="p">],</span> <span class="s1">&#39;Tweet_ID&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweets_ID&#39;</span><span class="p">],</span> <span class="s1">&#39;Events_Detected&#39;</span><span class="p">:</span> <span class="n">Events_Detected</span><span class="p">,</span> <span class="s1">&#39;Labels&#39;</span><span class="p">:</span> <span class="n">Labels</span><span class="p">,</span> <span class="s1">&#39;Actual_Tweet&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;updated_tweet&#39;</span><span class="p">],</span> <span class="s1">&#39;Tweet_Text&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_text&#39;</span><span class="p">],</span> <span class="s1">&#39;Tweet_date&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_date&#39;</span><span class="p">],</span> <span class="s1">&#39;Sentiment_Analyzed_Tweet&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_text&#39;</span><span class="p">]}</span>
                    <span class="n">data_collect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict1</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Going in exception for Tweets!!! -&gt;&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;create_tweets&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Word_Cloud&#39;</span><span class="p">:</span> <span class="n">word_cloud_freq</span><span class="p">,</span> <span class="s1">&#39;Tweets_List&#39;</span><span class="p">:</span> <span class="n">data_collect</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception in create_tweets &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_news"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.create_news">[docs]</a><span class="k">def</span> <span class="nf">create_news</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">all_news</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">events_json</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">s3_topic_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;Json/News/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">):</span>
                <span class="n">events_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">word_cloud_freq</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="ow">in</span> <span class="n">events_json</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">word_cloud_freq</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">word_cloud_freq</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;DATA NOT AVAILABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="p">[]}]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;Topic_News_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">word_cloud_freq</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">})</span>
        <span class="n">data_collect</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_news</span><span class="p">[</span><span class="n">ticker_data</span><span class="p">]):</span>
            <span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_ner_flag&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;sentiment_analysis&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;summary&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="p">(</span><span class="n">pos_sent</span><span class="p">,</span> <span class="n">neg_sent</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sentiment_class</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">sentiment_score</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">sentence</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
                                    <span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;</span><span class="si">{}</span><span class="s1">&lt;/</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">],</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">])</span>
                                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;long_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;long_description&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">str1</span><span class="p">)</span>
                                    <span class="n">pos_sent</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">elif</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
                                    <span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;</span><span class="si">{}</span><span class="s1">&lt;/</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">],</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">])</span>
                                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;long_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;long_description&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">str1</span><span class="p">)</span>
                                    <span class="n">neg_sent</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">{}</span><span class="s1">&gt;</span><span class="si">{}</span><span class="s1">&lt;/</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="s1">&#39;normal&#39;</span><span class="p">)</span>
                                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;long_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;long_description&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">str1</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception create news&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pos_sent</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">neg_sent</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sentiment_score</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sentiment_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_sent</span> <span class="o">-</span> <span class="n">neg_sent</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pos_sent</span> <span class="o">+</span> <span class="n">neg_sent</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sentiment_score</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sentiment_class</span> <span class="o">=</span> <span class="s1">&#39;positive&#39;</span>
                <span class="k">elif</span> <span class="n">sentiment_score</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sentiment_class</span> <span class="o">=</span> <span class="s1">&#39;negative&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sentiment_class</span> <span class="o">=</span> <span class="s1">&#39;neutral&#39;</span>
                <span class="n">Events_Detected</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Labels</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;Top_Events&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Null&#39;</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Top_Events&#39;</span><span class="p">]:</span>
                                <span class="n">Events_Detected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>
                                <span class="n">Labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Top_Events key not found in news&#39;</span><span class="p">)</span>
                    <span class="n">dict1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;News_Title&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="s1">&#39;News_Source&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_source&#39;</span><span class="p">],</span> <span class="s1">&#39;News_Sentiment&#39;</span><span class="p">:</span> <span class="n">sentiment_class</span><span class="p">,</span> <span class="s1">&#39;News_Time_Stamp&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;News_Sentiment_Score&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">sentiment_score</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;News_Summary&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">],</span> <span class="s1">&#39;News_Tags&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;News_ID&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_ID&#39;</span><span class="p">],</span> <span class="s1">&#39;Events_Detected&#39;</span><span class="p">:</span> <span class="n">Events_Detected</span><span class="p">,</span> <span class="s1">&#39;Labels&#39;</span><span class="p">:</span> <span class="n">Labels</span><span class="p">,</span> <span class="s1">&#39;News&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;long_description&#39;</span><span class="p">],</span> <span class="s1">&#39;Actual_News&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;long_description&#39;</span><span class="p">],</span> <span class="s1">&#39;News_date&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_date&#39;</span><span class="p">],</span> <span class="s1">&#39;Sentiment_Analyzed_News&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;long_description&#39;</span><span class="p">]}</span>
                    <span class="n">data_collect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict1</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Going in exception for News!!! -&gt;&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;create_news&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Word_Cloud&#39;</span><span class="p">:</span> <span class="n">word_cloud_freq</span><span class="p">,</span> <span class="s1">&#39;News_List&#39;</span><span class="p">:</span> <span class="n">data_collect</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception in create_news &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_prediction"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.create_prediction">[docs]</a><span class="k">def</span> <span class="nf">create_prediction</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nw</span> <span class="o">&gt;=</span> <span class="n">time1</span> <span class="ow">and</span> <span class="n">nw</span> <span class="o">&lt;=</span> <span class="n">time2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;show columns FROM </span><span class="si">{last5}</span><span class="s1">  &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last5</span><span class="o">=</span><span class="n">trends_prediction_stock_table</span><span class="p">))</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select date, output, percentile   FROM </span><span class="si">{prediction}</span><span class="s2"> where  ticker_id = &#39;</span><span class="si">{ticker_id}</span><span class="s2">&#39; ORDER BY prediction_date desc limit </span><span class="si">{num}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prediction</span><span class="o">=</span><span class="n">trends_prediction_stock_table</span><span class="p">,</span> <span class="n">ticker_id</span><span class="o">=</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Last_5_day_data&#39;</span><span class="p">])))</span>
            <span class="n">trends_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))}</span>
            <span class="n">filename5</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/trends_data.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename5</span><span class="p">,</span> <span class="n">trends_data</span><span class="p">)</span>
            <span class="n">trends_data</span> <span class="o">=</span> <span class="n">trends_data</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">trends_dic</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">trends_date</span><span class="p">,</span> <span class="n">trends_output</span><span class="p">,</span> <span class="n">trends_prediction</span><span class="p">)</span> <span class="ow">in</span> <span class="n">trends_data</span><span class="p">:</span>
                <span class="n">trends_date</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">trends_date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="n">trends_output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">trends_output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="n">trends_prediction</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">trends_prediction</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trends_date</span><span class="p">,</span> <span class="n">trends_output</span><span class="p">,</span> <span class="n">trends_prediction</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="s1">&#39;nan&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
                            <span class="n">trends_dic</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;days_5_trend_actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                            <span class="n">trends_dic</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;days_5_trend_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
                    <span class="k">elif</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
                        <span class="n">trends_dic</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;days_5_trend_actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="n">trends_dic</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;days_5_trend_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select percentile  FROM </span><span class="si">{prediction}</span><span class="s2"> where  ticker_id = &#39;</span><span class="si">{ticker_id}</span><span class="s2">&#39; order by prediction_date desc limit 1 &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prediction</span><span class="o">=</span><span class="n">trends_prediction_stock_table</span><span class="p">,</span> <span class="n">ticker_id</span><span class="o">=</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">]))</span>
            <span class="n">trends_prediction_stock_table_single_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))}</span>
            <span class="n">filename6</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/trends_prediction_stock_table_single_data.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename6</span><span class="p">,</span> <span class="n">trends_prediction_stock_table_single_data</span><span class="p">)</span>
            <span class="n">trends_prediction_stock_table_single_data</span> <span class="o">=</span> <span class="n">trends_prediction_stock_table_single_data</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select *  FROM </span><span class="si">{prediction}</span><span class="s2"> where  ticker_id = &#39;</span><span class="si">{ticker_id}</span><span class="s2">&#39; ORDER BY date DESC LIMIT 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prediction</span><span class="o">=</span><span class="n">rds_stock_next5Days_prediction_table</span><span class="p">,</span> <span class="n">ticker_id</span><span class="o">=</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">]))</span>
            <span class="n">next5_days_data_cursor</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">])}</span>
            <span class="n">filename7</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/next5_days_data_cursor.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename7</span><span class="p">,</span> <span class="n">next5_days_data_cursor</span><span class="p">)</span>
            <span class="n">next5_days_data_cursor</span> <span class="o">=</span> <span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">next5_days_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">next5_days_data_cursor</span><span class="p">))</span>
            <span class="n">next5_days_data_cursor</span> <span class="o">=</span> <span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">next5_days_data_cursor</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">(</span><span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">next5_days_result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">trend</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">trends_prediction_stock_table_single_data</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                    <span class="n">trend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">trend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">next5_days_data</span><span class="p">:</span>
                <span class="n">next5_days_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">next5_days_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">next5_days_result</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">next5_days_data</span> <span class="o">=</span> <span class="s1">&#39;RISE (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">next5_days_result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next5_days_data</span> <span class="o">=</span> <span class="s1">&#39;DROP (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">next5_days_result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select  last_5_dates, output_last_5_days, confidence_score, prediction_last_5_days FROM  </span><span class="si">{last5}</span><span class="s2"> where ticker_id=&#39;</span><span class="si">{ticker_id}</span><span class="s2">&#39; ORDER BY date DESC limit </span><span class="si">{num}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last5</span><span class="o">=</span><span class="n">rds_stock_last5Days_prediction_table</span><span class="p">,</span> <span class="n">ticker_id</span><span class="o">=</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Last_5_day_data&#39;</span><span class="p">])))</span>
            <span class="n">last5_days_prediction</span> <span class="o">=</span> <span class="p">[</span><span class="n">next5_days_data_cursor</span><span class="p">]</span>
            <span class="n">filename8_1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))}</span>
            <span class="n">filename8</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/filename8_1.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename8</span><span class="p">,</span> <span class="n">filename8_1</span><span class="p">)</span>
            <span class="n">filename8_1</span> <span class="o">=</span> <span class="n">filename8_1</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">last5_days_prediction</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">filename8_1</span><span class="p">)</span>
            <span class="n">last5_days_prediction_result</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">dict_output</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">last5_days_prediction</span><span class="p">:</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="n">output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="k">if</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
                <span class="n">confidence_score</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="k">if</span> <span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="p">[</span><span class="mf">0.72</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">]</span>
                <span class="n">prediction_output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">confidence_score</span><span class="p">,</span> <span class="n">prediction_output</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">output1</span> <span class="o">=</span> <span class="s1">&#39;RISE&#39;</span> <span class="k">if</span> <span class="n">out</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="s1">&#39;DROP&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">output1</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
                        <span class="n">last5_days_prediction_result</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">output1</span><span class="p">,</span> <span class="s1">&#39;confidence_score&#39;</span><span class="p">:</span> <span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;RISE&#39;</span> <span class="k">if</span> <span class="n">pred</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="s1">&#39;DROP&#39;</span><span class="p">}</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select DATE_FORMAT(</span><span class="si">{prediction}</span><span class="s2">.date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;), </span><span class="si">{prediction}</span><span class="s2">.output, </span><span class="si">{prediction}</span><span class="s2">.confidence_score, </span><span class="si">{prediction}</span><span class="s2">.actual_output FROM </span><span class="si">{prediction}</span><span class="s2"> where </span><span class="si">{prediction}</span><span class="s2">.ticker_id=&#39;</span><span class="si">{ticker_id}</span><span class="s2">&#39; ORDER BY </span><span class="si">{prediction}</span><span class="s2">.date DESC limit </span><span class="si">{num}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prediction</span><span class="o">=</span><span class="n">rds_stock_prediction_table</span><span class="p">,</span> <span class="n">ticker_id</span><span class="o">=</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Predition_Number_Of_Days&#39;</span><span class="p">])))</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))}</span>
            <span class="n">filename9</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/prediction_RDS.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename9</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">histroy_prediction</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prediction</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">last5_data</span> <span class="o">=</span> <span class="n">last5_days_prediction_result</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">list_working_days</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;day_1_predicted&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)),</span> <span class="s1">&#39;days_1_predicted_status&#39;</span><span class="p">:</span> <span class="n">val</span><span class="p">,</span> <span class="s1">&#39;day_1_actual&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
                    <span class="k">if</span> <span class="n">trends_dic</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_trend_actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">trends_dic</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;days_5_trend_actual&#39;</span><span class="p">])</span>
                        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_trend_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trends_dic</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;days_5_trend_predicted&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]:</span>
                        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;confidence_score&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_predicted_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_predicted_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;day_5_actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
                    <span class="n">histroy_prediction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dic</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;create prediction&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;prediction_for&#39;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;day_1y_ahead_strategy&#39;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;day_1_confidence_score&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;day_1_actual_output&#39;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;days_5_ahead_strategy&#39;</span><span class="p">:</span> <span class="n">next5_days_data</span><span class="p">,</span> <span class="s1">&#39;days_5_trend_detection&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">trend</span><span class="p">))},</span> <span class="s1">&#39;historical_prediction_accuracy&#39;</span><span class="p">:</span> <span class="n">histroy_prediction</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename5</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/trends_data.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">trends_data</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename5</span><span class="p">)</span>
            <span class="n">trends_data</span> <span class="o">=</span> <span class="n">trends_data</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">trends_dic</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">trends_date</span><span class="p">,</span> <span class="n">trends_output</span><span class="p">,</span> <span class="n">trends_prediction</span><span class="p">)</span> <span class="ow">in</span> <span class="n">trends_data</span><span class="p">:</span>
                <span class="n">trends_date</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">trends_date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="n">trends_output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">trends_output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="n">trends_prediction</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">trends_prediction</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trends_date</span><span class="p">,</span> <span class="n">trends_output</span><span class="p">,</span> <span class="n">trends_prediction</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="s1">&#39;nan&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
                            <span class="n">trends_dic</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;days_5_trend_actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                            <span class="n">trends_dic</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;days_5_trend_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
                    <span class="k">elif</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
                        <span class="n">trends_dic</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;days_5_trend_actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="n">trends_dic</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;days_5_trend_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
            <span class="n">filename6</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/trends_prediction_stock_table_single_data.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">trends_prediction_stock_table_single_data</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename6</span><span class="p">)</span>
            <span class="n">trends_prediction_stock_table_single_data</span> <span class="o">=</span> <span class="n">trends_prediction_stock_table_single_data</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">filename7</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/next5_days_data_cursor.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">next5_days_data_cursor</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename7</span><span class="p">)</span>
            <span class="n">next5_days_data_cursor</span> <span class="o">=</span> <span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">next5_days_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">next5_days_data_cursor</span><span class="p">))</span>
            <span class="n">next5_days_data_cursor</span> <span class="o">=</span> <span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">next5_days_data_cursor</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">(</span><span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">next5_days_data_cursor</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">next5_days_result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">trend</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">trends_prediction_stock_table_single_data</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                    <span class="n">trend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">trend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">next5_days_data</span><span class="p">:</span>
                <span class="n">next5_days_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">next5_days_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">next5_days_result</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">next5_days_data</span> <span class="o">=</span> <span class="s1">&#39;RISE (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">next5_days_result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next5_days_data</span> <span class="o">=</span> <span class="s1">&#39;DROP (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">next5_days_result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">last5_days_prediction</span> <span class="o">=</span> <span class="p">[</span><span class="n">next5_days_data_cursor</span><span class="p">]</span>
            <span class="n">filename8</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/filename8_1.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">filename8_1</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename8</span><span class="p">)</span>
            <span class="n">filename8_1</span> <span class="o">=</span> <span class="n">filename8_1</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">last5_days_prediction</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">filename8_1</span><span class="p">)</span>
            <span class="n">last5_days_prediction_result</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">dict_output</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">last5_days_prediction</span><span class="p">:</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="n">output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="k">if</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
                <span class="n">confidence_score</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span> <span class="k">if</span> <span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="p">[</span><span class="mf">0.72</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">]</span>
                <span class="n">prediction_output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">confidence_score</span><span class="p">,</span> <span class="n">prediction_output</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">output1</span> <span class="o">=</span> <span class="s1">&#39;RISE&#39;</span> <span class="k">if</span> <span class="n">out</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="s1">&#39;DROP&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">output1</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
                        <span class="n">last5_days_prediction_result</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">output1</span><span class="p">,</span> <span class="s1">&#39;confidence_score&#39;</span><span class="p">:</span> <span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;RISE&#39;</span> <span class="k">if</span> <span class="n">pred</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="s1">&#39;DROP&#39;</span><span class="p">}</span>
            <span class="n">filename9</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/prediction_RDS.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename9</span><span class="p">)</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">histroy_prediction</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prediction</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">last5_data</span> <span class="o">=</span> <span class="n">last5_days_prediction_result</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">list_working_days</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;day_1_predicted&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)),</span> <span class="s1">&#39;days_1_predicted_status&#39;</span><span class="p">:</span> <span class="n">val</span><span class="p">,</span> <span class="s1">&#39;day_1_actual&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
                    <span class="k">if</span> <span class="n">trends_dic</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_trend_actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">trends_dic</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;days_5_trend_actual&#39;</span><span class="p">])</span>
                        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_trend_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trends_dic</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;days_5_trend_predicted&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]:</span>
                        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;confidence_score&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_predicted_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;days_5_predicted_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;day_5_actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last5_data</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
                    <span class="n">histroy_prediction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dic</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;prediction_for&#39;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;day_1y_ahead_strategy&#39;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;day_1_confidence_score&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;day_1_actual_output&#39;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;days_5_ahead_strategy&#39;</span><span class="p">:</span> <span class="n">next5_days_data</span><span class="p">,</span> <span class="s1">&#39;days_5_trend_detection&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">trend</span><span class="p">))},</span> <span class="s1">&#39;historical_prediction_accuracy&#39;</span><span class="p">:</span> <span class="n">histroy_prediction</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception in create_prediction &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_technical_analysis"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.create_technical_analysis">[docs]</a><span class="k">def</span> <span class="nf">create_technical_analysis</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">all_news</span><span class="p">,</span> <span class="n">all_tweets</span><span class="p">,</span> <span class="n">sect_dict</span><span class="p">,</span> <span class="n">sector</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">total_news</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_vs_ticker_news</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">updated_dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_news</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">sect_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">]:</span>
                    <span class="n">total_vs_ticker_news</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;total_news&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                <span class="k">if</span> <span class="n">keys</span> <span class="o">==</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">]:</span>
                    <span class="n">total_vs_ticker_news</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;news_ticker&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
        <span class="n">res_total_vs_ticker_news</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">total_vs_ticker_news</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">total_vs_ticker_news</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">total_vs_ticker_news</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">res_total_vs_ticker_news</span><span class="p">[</span><span class="s1">&#39;total_news&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="s1">&#39;total_news&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;total_news&#39;</span><span class="p">])})</span>
            <span class="n">res_total_vs_ticker_news</span><span class="p">[</span><span class="s1">&#39;news_ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="s1">&#39;news_ticker&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_ticker&#39;</span><span class="p">])})</span>
            <span class="n">res_total_vs_ticker_news</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">sentiment_vs_volume</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">updated_dict</span><span class="p">)</span>
        <span class="n">sent_news_max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sent_news_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_news</span><span class="p">[</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">]]:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;news&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;news_ner_flag&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;sentiment_analysis&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">sentence</span><span class="p">:</span>
                            <span class="n">sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;cnt_pos_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;pos_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;positive_sentiment_score&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="n">sent_news_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sent_news_max</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;positive_sentiment_score&#39;</span><span class="p">]))</span>
                            <span class="n">sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;cnt_neg_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;neg_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;negative_sentiment_score&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="n">sent_news_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sent_news_max</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;negative_sentiment_score&#39;</span><span class="p">]))</span>
                            <span class="n">sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;cnt_neu_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;neu_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;neutral_sentiment_score&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="n">sent_news_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sent_news_max</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;neutral_sentiment_score&#39;</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception ++++ tech&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">sentiment_vs_volume</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">sentiment_vs_volume</span><span class="p">)</span>
        <span class="n">res_sentiment_vs_volume</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;sent_news_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sent_news_max</span>
        <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;sent_news_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sent_news_min</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sentiment_vs_volume</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_pos_sent&#39;</span><span class="p">]:</span>
                <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;pos_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;pos_sent&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_pos_sent&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;pos_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_neg_sent&#39;</span><span class="p">]:</span>
                <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;neg_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;neg_sent&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_neg_sent&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;neg_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_neu_sent&#39;</span><span class="p">]:</span>
                <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;neu_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;neu_sent&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_neu_sent&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;neu_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
            <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">res_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;news&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;news&#39;</span><span class="p">])})</span>
        <span class="n">total_vs_ticker_tweet</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">updated_dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_tweets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">sect_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">]:</span>
                    <span class="n">total_vs_ticker_tweet</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;total_tweet&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                <span class="k">if</span> <span class="n">keys</span> <span class="o">==</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">]:</span>
                    <span class="n">total_vs_ticker_tweet</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;tweet_ticker&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
        <span class="n">total_vs_ticker_tweet</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">total_vs_ticker_tweet</span><span class="p">)</span>
        <span class="n">res_total_vs_ticker_tweet</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">total_vs_ticker_tweet</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">res_total_vs_ticker_tweet</span><span class="p">[</span><span class="s1">&#39;total_tweet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="s1">&#39;total_tweet&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;total_tweet&#39;</span><span class="p">])})</span>
            <span class="n">res_total_vs_ticker_tweet</span><span class="p">[</span><span class="s1">&#39;tweet_ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="s1">&#39;tweet_ticker&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_ticker&#39;</span><span class="p">])})</span>
            <span class="n">res_total_vs_ticker_tweet</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">tweet_sentiment_vs_volume</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">updated_dict</span><span class="p">)</span>
        <span class="n">sent_tweet_max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sent_tweet_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_tweets</span><span class="p">[</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">]]:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tweet_sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;tweet&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet_ner_flag&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;sentiment_analysis&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;sentiment_analysis&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">sentence</span><span class="p">:</span>
                            <span class="n">tweet_sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;cnt_pos_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">tweet_sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;pos_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;positive_sentiment_score&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="n">sent_tweet_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sent_tweet_max</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;positive_sentiment_score&#39;</span><span class="p">]))</span>
                            <span class="n">tweet_sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;cnt_neg_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">tweet_sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;neg_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;negative_sentiment_score&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="n">sent_tweet_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sent_tweet_max</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;negative_sentiment_score&#39;</span><span class="p">]))</span>
                            <span class="n">tweet_sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;cnt_neu_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">tweet_sentiment_vs_volume</span><span class="p">[</span><span class="n">date</span><span class="p">][</span><span class="s1">&#39;neu_sent&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;neutral_sentiment_score&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="n">sent_tweet_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sent_tweet_max</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="s1">&#39;neutral_sentiment_score&#39;</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception+++++ new tech&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">res_tweet_sentiment_vs_volume</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">tweet_sentiment_vs_volume</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">tweet_sentiment_vs_volume</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tweet_sentiment_vs_volume</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_pos_sent&#39;</span><span class="p">]:</span>
                <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;pos_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;pos_sent&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_pos_sent&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;pos_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_neg_sent&#39;</span><span class="p">]:</span>
                <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;neg_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;neg_sent&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_neg_sent&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;neg_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_neu_sent&#39;</span><span class="p">]:</span>
                <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;neu_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;neu_sent&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;cnt_neu_sent&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;neu_sent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
            <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;tweets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;tweet&#39;</span><span class="p">])})</span>
        <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;sent_tweet_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sent_tweet_max</span>
        <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">[</span><span class="s1">&#39;sent_tweet_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sent_tweet_min</span>
        <span class="n">candle_stick_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">close_vs_volume</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">max1_close</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">min1_close</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nw</span> <span class="o">&gt;=</span> <span class="n">time1</span> <span class="ow">and</span> <span class="n">nw</span> <span class="o">&lt;=</span> <span class="n">time2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select open, close, high, low, volume, DATE_FORMAT(date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;)  from </span><span class="si">{table}</span><span class="s2"> where ticker_id=&#39;</span><span class="si">{symbol}</span><span class="s2">&#39; and DATE_FORMAT(date, &#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;) between &#39;</span><span class="si">{summary}</span><span class="s2">&#39; and &#39;</span><span class="si">{today}</span><span class="s2">&#39; and DATE_FORMAT(date, &#39;%H&#39;) &gt;= &#39;</span><span class="si">{close_time}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">],</span> <span class="n">summary</span><span class="o">=</span><span class="n">summary_data_days</span><span class="p">,</span> <span class="n">today</span><span class="o">=</span><span class="n">today_date</span><span class="p">,</span> <span class="n">close_time</span><span class="o">=</span><span class="s1">&#39;15&#39;</span><span class="p">))</span>
            <span class="n">candle_stick</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))}</span>
            <span class="n">candle_final</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="n">check_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">candle_stick</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check_map</span><span class="p">:</span>
                    <span class="n">check_map</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">candle_final</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">candle_stick</span> <span class="o">=</span> <span class="n">candle_final</span>
            <span class="n">filename10</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/candle_stick.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename10</span><span class="p">,</span> <span class="n">candle_stick</span><span class="p">)</span>
            <span class="n">candle_stick</span> <span class="o">=</span> <span class="n">candle_stick</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">open1</span><span class="p">,</span> <span class="n">close</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="ow">in</span> <span class="n">candle_stick</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
                    <span class="n">candle_stick_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">open1</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">close</span><span class="p">]})</span>
                    <span class="n">max1_close</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max1_close</span><span class="p">,</span> <span class="n">close</span><span class="p">)</span>
                    <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                    <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">close</span><span class="p">})</span>
                    <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">volume</span><span class="p">)})</span>
                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;max1_close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max1_close</span>
            <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;min1_close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min1_close</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;create technical analysis&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Stock_Candle_Stick_Data&#39;</span><span class="p">:</span> <span class="n">candle_stick_data</span><span class="p">,</span> <span class="s1">&#39;Stock_Candle_Stick_Data_y_format&#39;</span><span class="p">:</span> <span class="s1">&#39;[open, high, low, close]&#39;</span><span class="p">,</span> <span class="s1">&#39;close_vs_volume&#39;</span><span class="p">:</span> <span class="n">close_vs_volume</span><span class="p">,</span> <span class="s1">&#39;news_count_vs_total_news&#39;</span><span class="p">:</span> <span class="n">res_total_vs_ticker_news</span><span class="p">,</span> <span class="s1">&#39;news_sentiment_vs_volume&#39;</span><span class="p">:</span> <span class="n">res_sentiment_vs_volume</span><span class="p">,</span> <span class="s1">&#39;tweet_count_vs_total_tweet&#39;</span><span class="p">:</span> <span class="n">res_total_vs_ticker_tweet</span><span class="p">,</span> <span class="s1">&#39;tweet_sentiment_vs_volume&#39;</span><span class="p">:</span> <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename10</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/candle_stick.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">candle_stick</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename10</span><span class="p">)</span>
            <span class="n">candle_stick</span> <span class="o">=</span> <span class="n">candle_stick</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">open1</span><span class="p">,</span> <span class="n">close</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="ow">in</span> <span class="n">candle_stick</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
                    <span class="n">candle_stick_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">open1</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">close</span><span class="p">]})</span>
                    <span class="n">max1_close</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max1_close</span><span class="p">,</span> <span class="n">close</span><span class="p">)</span>
                    <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                    <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">close</span><span class="p">})</span>
                    <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">volume</span><span class="p">)})</span>
                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;max1_close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max1_close</span>
            <span class="n">close_vs_volume</span><span class="p">[</span><span class="s1">&#39;min1_close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min1_close</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Stock_Candle_Stick_Data&#39;</span><span class="p">:</span> <span class="n">candle_stick_data</span><span class="p">,</span> <span class="s1">&#39;Stock_Candle_Stick_Data_y_format&#39;</span><span class="p">:</span> <span class="s1">&#39;[open, high, low, close]&#39;</span><span class="p">,</span> <span class="s1">&#39;close_vs_volume&#39;</span><span class="p">:</span> <span class="n">close_vs_volume</span><span class="p">,</span> <span class="s1">&#39;news_count_vs_total_news&#39;</span><span class="p">:</span> <span class="n">res_total_vs_ticker_news</span><span class="p">,</span> <span class="s1">&#39;news_sentiment_vs_volume&#39;</span><span class="p">:</span> <span class="n">res_sentiment_vs_volume</span><span class="p">,</span> <span class="s1">&#39;tweet_count_vs_total_tweet&#39;</span><span class="p">:</span> <span class="n">res_total_vs_ticker_tweet</span><span class="p">,</span> <span class="s1">&#39;tweet_sentiment_vs_volume&#39;</span><span class="p">:</span> <span class="n">res_tweet_sentiment_vs_volume</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error occured in crete technical analysis&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_header"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.create_header">[docs]</a><span class="k">def</span> <span class="nf">create_header</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">list_months</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nw</span> <span class="o">&gt;=</span> <span class="n">time1</span> <span class="ow">and</span> <span class="n">nw</span> <span class="o">&lt;=</span> <span class="n">time2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="ow">in</span> <span class="n">list_working_days</span><span class="p">:</span>
            <span class="n">Last_Updated</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span>
            <span class="n">Last_Updated_Stocks</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="n">Last_Updated</span><span class="p">}</span>
            <span class="n">filename11</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Last_Updated_Stocks.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename11</span><span class="p">,</span> <span class="n">Last_Updated_Stocks</span><span class="p">)</span>
            <span class="n">return_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Stock_ID&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Stock_Name&#39;</span><span class="p">:</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">],</span> <span class="s1">&#39;Stock_Symbol&#39;</span><span class="p">:</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">],</span> <span class="s1">&#39;Stock_Sector&#39;</span><span class="p">:</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Sector&#39;</span><span class="p">],</span> <span class="s1">&#39;Last_Updated&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">),</span> <span class="s1">&#39;Last_Updated_Stocks&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">28</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)}</span>
            <span class="n">date_days_ago</span> <span class="o">=</span> <span class="n">today_date</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="n">date_days_ago</span><span class="o">.</span><span class="n">weekday</span><span class="p">()]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Saturday&#39;</span><span class="p">,</span> <span class="s1">&#39;Sunday&#39;</span><span class="p">]:</span>
                <span class="n">date_days_ago</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">relativedelta</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="n">FR</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="si">:</span><span class="s1">%Y-%m-%d</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select Open, Close, Volume, date  from </span><span class="si">{}</span><span class="s2"> where ticker_id=&#39;</span><span class="si">{}</span><span class="s2">&#39; and DATE_FORMAT(date, &#39;%H&#39;) &gt;= &#39;</span><span class="si">{}</span><span class="s2">&#39; ORDER BY date DESC LIMIT 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">],</span> <span class="s1">&#39;15&#39;</span><span class="p">))</span>
            <span class="n">yesterday</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))}</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">yesterday</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)))</span>
            <span class="n">yesterday</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">yesterday</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
            <span class="n">filename12</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/yesterday2.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;yesterday-&gt;&#39;</span><span class="p">,</span> <span class="n">yesterday</span><span class="p">)</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename12</span><span class="p">,</span> <span class="n">yesterday</span><span class="p">)</span>
            <span class="n">yesterday</span> <span class="o">=</span> <span class="n">yesterday</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select Open, Close, Volume, date  from </span><span class="si">{}</span><span class="s2"> where ticker_id=&#39;</span><span class="si">{}</span><span class="s2">&#39; ORDER BY date DESC LIMIT 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rds_stock_data_table</span><span class="p">,</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">]))</span>
            <span class="n">today</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Records&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()))}</span>
            <span class="n">filename13</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/today.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">write_json_file</span><span class="p">(</span><span class="n">filename13</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">today</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">today</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">yesterday</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Yesterdays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Open&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">today</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Open&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Yesterdays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">yesterday</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yesterday</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Yesterdays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Open&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Yesterdays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">yesterday</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Open&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;create header data&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">return_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename11</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Last_Updated_Stocks.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">Last_Updated_Stocks</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename11</span><span class="p">)</span>
            <span class="n">Last_Updated_Stocks</span> <span class="o">=</span> <span class="n">Last_Updated_Stocks</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">return_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Stock_ID&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Stock_Name&#39;</span><span class="p">:</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">],</span> <span class="s1">&#39;Stock_Symbol&#39;</span><span class="p">:</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">],</span> <span class="s1">&#39;Stock_Sector&#39;</span><span class="p">:</span> <span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Sector&#39;</span><span class="p">],</span> <span class="s1">&#39;Last_Updated&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">),</span> <span class="s1">&#39;Last_Updated_Stocks&#39;</span><span class="p">:</span> <span class="n">Last_Updated_Stocks</span><span class="p">}</span>
            <span class="n">date_days_ago</span> <span class="o">=</span> <span class="n">today_date</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="n">date_days_ago</span><span class="o">.</span><span class="n">weekday</span><span class="p">()]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Saturday&#39;</span><span class="p">,</span> <span class="s1">&#39;Sunday&#39;</span><span class="p">]:</span>
                <span class="n">date_days_ago</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">relativedelta</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="n">FR</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="si">:</span><span class="s1">%Y-%m-%d</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">filename12</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/yesterday2.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">yesterday</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename12</span><span class="p">)</span>
            <span class="n">yesterday</span> <span class="o">=</span> <span class="n">yesterday</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="n">filename13</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/today.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Stock_Ticker_Symbol&#39;</span><span class="p">])</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">read_data_from_s3</span><span class="p">(</span><span class="n">default_bucket</span><span class="p">,</span> <span class="n">filename13</span><span class="p">)</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">today</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">today</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">yesterday</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Yesterdays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Open&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">today</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Open&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Yesterdays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">yesterday</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yesterday</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Yesterdays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Data not Present&#39;</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Open&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Yesterdays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">yesterday</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Open&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">return_data</span><span class="p">[</span><span class="s1">&#39;Todays_Close&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">today</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">return_data</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error occured in create header&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_company_docs"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.create_company_docs">[docs]</a><span class="k">def</span> <span class="nf">create_company_docs</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">):</span>
    <span class="n">data_collect</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">earnings_result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">s3_client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">pdf_topic_bucket</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;EarningCalls&#39;</span><span class="p">,</span> <span class="n">ticker_data</span><span class="p">),</span> <span class="n">Delimiter</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">QuarterlyReports_result</span> <span class="o">=</span> <span class="n">s3_client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">pdf_topic_bucket</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;QuarterlyReports&#39;</span><span class="p">,</span> <span class="n">ticker_data</span><span class="p">),</span> <span class="n">Delimiter</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CommonPrefixes&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">object_summary</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CommonPrefixes&#39;</span><span class="p">):</span>
            <span class="n">earnings</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">earnings</span><span class="p">[</span><span class="s1">&#39;fy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FY</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">object_summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Prefix&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">earnings</span><span class="p">[</span><span class="s1">&#39;transcripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">earnings</span><span class="p">[</span><span class="s1">&#39;insights&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">tcnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">icnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">theobjects</span> <span class="o">=</span> <span class="n">s3_client</span><span class="o">.</span><span class="n">list_objects_v2</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">pdf_topic_bucket</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="n">object_summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Prefix&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">theobjects</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">theobjects</span><span class="p">[</span><span class="s1">&#39;Contents&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pdf&#39;</span><span class="p">):</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">tcnt</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://</span><span class="si">{}</span><span class="s1">.blob.core.windows.net/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;BlobAccount&#39;</span><span class="p">],</span> <span class="n">pdf_topic_bucket</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">])}</span>
                        <span class="n">earnings</span><span class="p">[</span><span class="s1">&#39;transcripts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">tcnt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
                        <span class="n">result_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s3_client</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">pdf_topic_bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">])[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">tcnt</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;Top_Positive_Topics&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Higher Margin&#39;</span><span class="p">,</span> <span class="s1">&#39;New Products&#39;</span><span class="p">],</span> <span class="s1">&#39;Top_Negative_Topics&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Downtrading&#39;</span><span class="p">,</span> <span class="s1">&#39;Low Profit&#39;</span><span class="p">],</span> <span class="s1">&#39;Transcript_Analysis&#39;</span><span class="p">:</span> <span class="p">[]}</span>
                        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Top_Positive_Topics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result_data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;Overall_topics&#39;</span><span class="p">][</span><span class="s1">&#39;Positive&#39;</span><span class="p">]]</span>
                        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Top_Negative_Topics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result_data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="s1">&#39;Overall_topics&#39;</span><span class="p">][</span><span class="s1">&#39;Negative&#39;</span><span class="p">]]</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result_data</span><span class="p">[</span><span class="s1">&#39;Output&#39;</span><span class="p">][</span><span class="s1">&#39;Overall_Documents&#39;</span><span class="p">]):</span>
                            <span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Sentiments&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Positive&#39;</span><span class="p">:</span>
                                <span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39;&lt;positive&gt;</span><span class="si">{}</span><span class="s1">&lt;/positive&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;Answers&#39;</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Sentiments&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Negative&#39;</span><span class="p">:</span>
                                <span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39;&lt;negative&gt;</span><span class="si">{}</span><span class="s1">&lt;/negative&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;Answers&#39;</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39;&lt;normal&gt;</span><span class="si">{}</span><span class="s1">&lt;/normal&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;Answers&#39;</span><span class="p">])</span>
                            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Transcript_Analysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Questions&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Questions&#39;</span><span class="p">],</span> <span class="s1">&#39;Answers&#39;</span><span class="p">:</span> <span class="n">answer</span><span class="p">,</span> <span class="s1">&#39;doc_sentiment&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;Sentiments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()})</span>
                        <span class="n">earnings</span><span class="p">[</span><span class="s1">&#39;insights&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">icnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">earnings_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">earnings</span><span class="p">)</span>
    <span class="n">QuarterlyReports</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">quaterly_annual_reports</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">QuarterlyReports_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CommonPrefixes&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">object_summary</span> <span class="ow">in</span> <span class="n">QuarterlyReports_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CommonPrefixes&#39;</span><span class="p">):</span>
            <span class="n">QuarterlyReports</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">QuarterlyReports</span><span class="p">[</span><span class="s1">&#39;fy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FY</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">object_summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Prefix&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">QuarterlyReports</span><span class="p">[</span><span class="s1">&#39;Reports&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">theobjects</span> <span class="o">=</span> <span class="n">s3_client</span><span class="o">.</span><span class="n">list_objects_v2</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">pdf_topic_bucket</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="n">object_summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Prefix&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">theobjects</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">theobjects</span><span class="p">[</span><span class="s1">&#39;Contents&#39;</span><span class="p">]:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;AnnualReport&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;Annual&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://</span><span class="si">{}</span><span class="s1">.s3.ap-south-1.amazonaws.com/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pdf_topic_bucket</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">])}</span>
                    <span class="n">QuarterlyReports</span><span class="p">[</span><span class="s1">&#39;Reports&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">quaterly_annual_reports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QuarterlyReports</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;create company docs&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Earnings&#39;</span><span class="p">:</span> <span class="n">earnings_result</span><span class="p">,</span> <span class="s1">&#39;QuarterlyReports&#39;</span><span class="p">:</span> <span class="n">quaterly_annual_reports</span><span class="p">}</span></div>



<div class="viewcode-block" id="fetch_debrief_data"><a class="viewcode-back" href="../../docker_debrief.html#docker_debrief.create_json.fetch_debrief_data">[docs]</a><span class="k">def</span> <span class="nf">fetch_debrief_data</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">list_months</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">all_tweets</span><span class="p">,</span> <span class="n">all_news</span><span class="p">,</span> <span class="n">Predition_Number_Of_Days</span><span class="p">,</span> <span class="n">sect_dict</span><span class="p">,</span> <span class="n">sector</span><span class="p">):</span>
    <span class="n">header_information</span> <span class="o">=</span> <span class="n">create_header</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">list_months</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">overview</span> <span class="o">=</span> <span class="n">create_overview</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">list_months</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">all_news</span><span class="p">,</span> <span class="n">all_tweets</span><span class="p">)</span>
    <span class="n">tweets</span> <span class="o">=</span> <span class="n">create_tweets</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">],</span> <span class="n">all_tweets</span><span class="p">)</span>
    <span class="n">news</span> <span class="o">=</span> <span class="n">create_news</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">[</span><span class="s1">&#39;Ticker_Name&#39;</span><span class="p">],</span> <span class="n">all_news</span><span class="p">)</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">create_prediction</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">Predition_Number_Of_Days</span><span class="p">)</span>
    <span class="n">technical_analysis</span> <span class="o">=</span> <span class="n">create_technical_analysis</span><span class="p">(</span><span class="n">ticker_data</span><span class="p">,</span> <span class="n">summary_data_days</span><span class="p">,</span> <span class="n">today_date</span><span class="p">,</span> <span class="n">all_news</span><span class="p">,</span> <span class="n">all_tweets</span><span class="p">,</span> <span class="n">sect_dict</span><span class="p">,</span> <span class="n">sector</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;fetch debrief data&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;header_information&#39;</span><span class="p">:</span> <span class="n">header_information</span><span class="p">,</span> <span class="s1">&#39;overview_tab&#39;</span><span class="p">:</span> <span class="n">overview</span><span class="p">,</span> <span class="s1">&#39;tweets&#39;</span><span class="p">:</span> <span class="n">tweets</span><span class="p">,</span> <span class="s1">&#39;news&#39;</span><span class="p">:</span> <span class="n">news</span><span class="p">,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">,</span> <span class="s1">&#39;technical_analysis&#39;</span><span class="p">:</span> <span class="n">technical_analysis</span><span class="p">}</span></div>



</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ABC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>